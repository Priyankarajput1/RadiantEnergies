<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiant Energies | Made by Ram</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@300;500;700&display=swap');

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #050214;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #000000 80%);
            color: #e2e8f0; 
            min-height: 100vh;
        }

        h1, h2, h3, .font-display { font-family: 'Space Grotesk', sans-serif; }
        .font-digital { font-family: 'Share Tech Mono', monospace; }
        
        /* Sliders & Scrollbars */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #312e81; border-radius: 4px; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
            background: #8b5cf6; cursor: pointer; margin-top: -7px;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.8); border: 2px solid #fff;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: rgba(255,255,255,0.15); border-radius: 2px;
        }

        /* Animations */
        .flow-path { stroke-dasharray: 10; animation: flow 1s linear infinite; }
        .flow-path-reverse { stroke-dasharray: 10; animation: flowRev 1s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -20; } }
        @keyframes flowRev { to { stroke-dashoffset: 20; } }
        
        .glass-panel {
            background: rgba(15, 10, 35, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        .text-glow { text-shadow: 0 0 15px rgba(139, 92, 246, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const SunIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-12 h-12" strokeWidth="1.5"><circle cx="12" cy="12" r="4" fill="currentColor" fillOpacity="0.2"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"></path></svg>
        );
        const GridIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-8 h-8 text-slate-300" strokeWidth="1.5"><path d="M8 14L7 23M16 14L17 23M4 6l8-4 8 4M12 2v22M4 14h16M4 10h16M4 6h16"></path></svg>
        );
        const HomeIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-8 h-8" strokeWidth="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><rect x="10" y="3" width="4" height="6" fill="currentColor" fillOpacity="0.2"></rect></svg>
        );
        const InverterIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-12 h-12 text-slate-400" strokeWidth="1.5"><rect x="2" y="2" width="20" height="20" rx="2"></rect><path d="M6 12h12M6 12l2-3 4 6 4-6 2 3"></path></svg>
        );
        const BatteryIcon = ({level}) => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-10 h-10 text-white" strokeWidth="1.5"><rect x="1" y="6" width="18" height="12" rx="2"></rect><line x1="23" y1="13" x2="23" y2="11"></line><rect x="3" y="8" width={Math.max(0, (level/100)*14)} height="8" rx="1" fill="currentColor"></rect></svg>
        );

        // --- COMPONENTS ---
        const InverterScreen = ({ solarWatts, loadWatts, gridStatus, batteryStatus, batteryLevel, systemType, systemVolts, pvVolts, chargingWatts }) => {
            const sWatts = solarWatts || 0;
            const lWatts = loadWatts || 0;
            const cWatts = chargingWatts || 0;
            const pvV = pvVolts || 1;
            const pvA = (sWatts / pvV).toFixed(1);
            
            let gridTxt = "0 W";
            let gridLbl = "IDLE";
            let gridCol = "text-slate-500";

            if (gridStatus) {
                const consumption = lWatts + (batteryStatus === 'Charging' ? cWatts : 0);
                const net = sWatts - consumption;

                if (net >= 0) {
                    // Surplus
                    gridTxt = `${Math.abs(Math.round(net))} W`;
                    gridLbl = "EXPORT";
                    gridCol = "text-green-400";
                } else {
                    // Deficit
                    gridTxt = `${Math.abs(Math.round(net))} W`;
                    gridLbl = "IMPORT";
                    gridCol = "text-red-400";
                }
            } else {
                gridLbl = "CUT";
                gridCol = "text-red-500";
            }

            // Estimate Battery Current
            let batAmps = "0.0";
            if(batteryStatus === 'Charging') batAmps = (cWatts / systemVolts).toFixed(1);
            if(batteryStatus === 'Discharging') {
                const dischargeWatts = lWatts - sWatts;
                batAmps = (Math.max(0, dischargeWatts) / systemVolts).toFixed(1);
            }

            return (
                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30 pointer-events-none">
                    <div className="w-52 bg-black/90 backdrop-blur-xl rounded-xl border border-violet-500/30 p-4 shadow-2xl">
                        <div className="flex justify-between items-center mb-3 border-b border-white/10 pb-2">
                            <span className="text-[10px] text-violet-300 font-display tracking-widest">SMART INVERTER</span>
                            <div className={`w-1.5 h-1.5 rounded-full ${sWatts > 0 ? 'bg-green-400 animate-pulse' : 'bg-slate-600'}`}></div>
                        </div>
                        <div className="grid grid-cols-2 gap-3 font-digital text-xs">
                            <div className="bg-white/5 p-2 rounded border border-white/5">
                                <div className="text-[9px] text-yellow-400 mb-0.5">PV INPUT</div>
                                <div className="text-white text-sm">{sWatts} W</div>
                                <div className="text-slate-500 text-[9px]">{pvVolts.toFixed(0)}V | {pvA}A</div>
                            </div>
                            <div className="bg-white/5 p-2 rounded border border-white/5">
                                <div className="text-[9px] text-blue-400 mb-0.5">GRID</div>
                                <div className={`text-sm ${gridCol}`}>{gridTxt}</div>
                                <div className="text-[9px] text-slate-500">{gridLbl}</div>
                            </div>
                            <div className="bg-white/5 p-2 rounded border border-white/5">
                                <div className="text-[9px] text-emerald-400 mb-0.5">BATTERY</div>
                                <div className="text-white text-sm">{systemType === 'On-Grid' ? '--' : batteryLevel.toFixed(0)+'%'}</div>
                                <div className={`text-[9px] ${batteryStatus==='Charging'?'text-green-400':batteryStatus==='Discharging'?'text-yellow-400':'text-slate-500'}`}>
                                    {batteryStatus === 'Idle' ? '0.0 A' : `${batAmps} A`}
                                </div>
                            </div>
                            <div className="bg-white/5 p-2 rounded border border-white/5">
                                <div className="text-[9px] text-violet-400 mb-0.5">LOAD</div>
                                <div className="text-white text-sm">{lWatts} W</div>
                                <div className="text-slate-500 text-[9px]">{systemVolts}V AC</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Connection = ({ from, to, active }) => {
            const pos = { sun: {x:50,y:15}, inv: {x:50,y:50}, grid: {x:15,y:50}, home: {x:85,y:50}, bat: {x:50,y:85} };
            const p1 = pos[from]; const p2 = pos[to] || pos.inv;
            let d = `M${p1.x},${p1.y} L${p2.x},${p2.y}`;
            if((from==='grid'&&to==='home') || (from==='home'&&to==='grid')) d = `M${pos.grid.x},${pos.grid.y} Q50,20 ${pos.home.x},${pos.home.y}`;
            
            let color = "#fff";
            if(from==='sun') color="#fbbf24";
            if(from==='grid') color="#ef4444"; 
            if(from==='bat') color="#10b981";
            if(from==='inv' && to==='home') color="#8b5cf6";

            return (
                <>
                    <path d={d} stroke="rgba(255,255,255,0.1)" strokeWidth="1" fill="none" />
                    {active && <path d={d} stroke={color} strokeWidth="2" fill="none" className="flow-path" />}
                </>
            );
        };

        function App() {
            // --- STATE ---
            const [logo, setLogo] = useState(null);
            const [activeTab, setActiveTab] = useState('sim');
            const [systemType, setSystemType] = useState('Hybrid');
            const [hour, setHour] = useState(13);
            const [gridOn, setGridOn] = useState(true);
            const [batteryLevel, setBatteryLevel] = useState(50);
            
            // TopCon Array Config
            const [numStrings, setNumStrings] = useState(2);
            const [panelsPerString, setPanelsPerString] = useState(6);
            const [panelWatts, setPanelWatts] = useState(590);
            
            // Battery Config
            const [batteryAh, setBatteryAh] = useState(200);
            const [batteryVolt, setBatteryVolt] = useState(48);
            
            // Load & Grid
            const [loadWatts, setLoadWatts] = useState(800);
            const [cutStartTime, setCutStartTime] = useState(13);
            const [cutDuration, setCutDuration] = useState(0);

            // --- PHYSICS CALCULATIONS ---
            const systemSizeKW = (numStrings * panelsPerString * panelWatts) / 1000;
            const totalPanels = numStrings * panelsPerString;
            const systemPVVolts = panelsPerString * 52; // 52V Voc per panel
            
            const isDaytime = hour >= 6 && hour < 18;
            const sunIntensity = isDaytime ? Math.sin(((hour - 6) / 12) * Math.PI) : 0;
            const currentSolarWatts = Math.round(systemSizeKW * 1000 * sunIntensity * 0.85); // 85% Efficiency
            
            // Grid Logic
            const isScheduledCut = (hour >= cutStartTime && hour < cutStartTime + cutDuration);
            const effectiveGrid = gridOn && !isScheduledCut;
            
            // Effective Solar (On-Grid shuts down without grid)
            const effectiveSolar = (systemType === 'On-Grid' && !effectiveGrid) ? 0 : currentSolarWatts;

            // --- BATTERY ANALYTICS ---
            const batteryStats = useMemo(() => {
                const totalEnergykWh = (batteryVolt * batteryAh) / 1000;
                const dod = 0.90; // Li-Ion Standard
                const usablekWh = totalEnergykWh * dod; 
                
                const currentStoredkWh = (batteryLevel / 100) * totalEnergykWh;
                const unitsToFull = Math.max(0, totalEnergykWh - currentStoredkWh);
                
                // Discharge Time (Load dependent)
                const inverterEff = 0.9;
                const activeLoadKW = Math.max(loadWatts, 50) / 1000;
                // How long current charge will last at current load
                const dischargeHours = ((currentStoredkWh * 0.9 * inverterEff) / activeLoadKW).toFixed(1);

                return {
                    totalCapacity: totalEnergykWh.toFixed(2),
                    usableCapacity: usablekWh.toFixed(2),
                    unitsToFull: unitsToFull.toFixed(2),
                    estDischargeTime: dischargeHours
                };
            }, [batteryAh, batteryVolt, loadWatts, batteryLevel]);

            // --- SIMULATION & STATE DERIVATION ---
            const simState = useMemo(() => {
                let status = "System Idle";
                let houseSource = "None";
                let batteryStatus = "Idle";
                let flows = [];
                let chargingWatts = 0;
                let timeToFull = "N/A";
                
                // Grid Flow Calculation for UI Label
                let gridFlowLabel = "0 W";
                let gridFlowStatus = "IDLE"; // IMPORT / EXPORT

                if (loadWatts > 0) {
                    if (effectiveSolar > loadWatts) {
                        houseSource = "Solar";
                        flows.push({from: 'sun', to: 'inv'}, {from: 'inv', to: 'home'});
                        
                        // Surplus logic
                        if (batteryLevel < 100 && systemType !== 'On-Grid') {
                            batteryStatus = "Charging";
                            flows.push({from: 'inv', to: 'bat'});
                            const solarSurplus = effectiveSolar - loadWatts;
                            
                            // Hybrid Grid Assist
                            if(systemType === 'Hybrid' && effectiveGrid) {
                                chargingWatts = solarSurplus + (15 * batteryVolt); 
                            } else {
                                chargingWatts = solarSurplus;
                            }
                        } else if (effectiveGrid) {
                            flows.push({from: 'inv', to: 'grid'}); // Export
                        }
                    } else if (effectiveSolar > 0) {
                        houseSource = "Mix";
                        flows.push({from: 'sun', to: 'inv'}, {from: 'inv', to: 'home'});
                        
                        if (effectiveGrid) {
                            flows.push({from: 'grid', to: 'inv'}); // Supplement
                            if(systemType === 'Hybrid' && batteryLevel < 100) {
                                batteryStatus = "Charging";
                                flows.push({from: 'inv', to: 'bat'});
                                chargingWatts = 15 * batteryVolt; 
                            }
                        } else if (batteryLevel > 0 && systemType !== 'On-Grid') {
                            batteryStatus = "Discharging";
                            flows.push({from: 'bat', to: 'inv'});
                        } else {
                            houseSource = "Low Voltage";
                        }
                    } else {
                        // No Solar
                        if (effectiveGrid) {
                            houseSource = "Grid";
                            flows.push({from: 'grid', to: 'inv'}, {from: 'inv', to: 'home'});
                            if (systemType === 'Hybrid' && batteryLevel < 100) {
                                batteryStatus = "Charging";
                                flows.push({from: 'inv', to: 'bat'});
                                chargingWatts = 15 * batteryVolt;
                            }
                        } else if (batteryLevel > 0 && systemType !== 'On-Grid') {
                            houseSource = "Battery";
                            batteryStatus = "Discharging";
                            flows.push({from: 'bat', to: 'inv'}, {from: 'inv', to: 'home'});
                        } else {
                            houseSource = "Blackout";
                            status = "POWER FAILURE";
                        }
                    }
                }
                
                if (houseSource !== "Blackout") status = "System Active";

                // Calc Time to Full
                if(batteryStatus === 'Charging' && chargingWatts > 0) {
                    const hoursLeft = (parseFloat(batteryStats.unitsToFull) * 1000) / chargingWatts;
                    timeToFull = hoursLeft > 99 ? ">99h" : hoursLeft.toFixed(1) + "h";
                } else if (batteryLevel >= 100) {
                    timeToFull = "Charged";
                }
                
                // Determine Grid Flow Label
                if (effectiveGrid) {
                    const consumption = loadWatts + (batteryStatus === 'Charging' ? chargingWatts : 0);
                    const net = effectiveSolar - consumption;
                    if (net >= 0) {
                        gridFlowLabel = `EXP: ${Math.round(net)} W`;
                        gridFlowStatus = "EXPORT";
                    } else {
                        gridFlowLabel = `IMP: ${Math.abs(Math.round(net))} W`;
                        gridFlowStatus = "IMPORT";
                    }
                } else {
                    gridFlowLabel = "CUT";
                    gridFlowStatus = "CUT";
                }

                return { status, houseSource, batteryStatus, flows, effectiveSolar, effectiveGrid, chargingWatts, timeToFull, gridFlowLabel, gridFlowStatus };
            }, [systemType, hour, gridOn, batteryLevel, currentSolarWatts, loadWatts, cutStartTime, cutDuration, batteryStats, batteryVolt]);

            // --- ANIMATION LOOP ---
            useEffect(() => {
                const timer = setInterval(() => {
                    setBatteryLevel(prev => {
                        let change = 0;
                        if (systemType === 'On-Grid') return 0;
                        if(simState.batteryStatus === 'Charging') change = 0.2;
                        if(simState.batteryStatus === 'Discharging') change = -0.2;
                        return Math.min(100, Math.max(0, prev + change));
                    });
                }, 200);
                return () => clearInterval(timer);
            }, [simState.batteryStatus, systemType]);

            // --- YIELD STATS ---
            const dailyGen = (systemSizeKW * 5.0);
            let loss = 0;
            if (systemType === 'On-Grid' && cutDuration > 0) {
                loss = dailyGen * (Math.min(cutDuration, 12)/12);
            }
            const netDailyGen = dailyGen - loss;

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    {/* NAVBAR */}
                    <nav className="glass-panel z-50 px-6 py-4 flex justify-between items-center">
                        <div className="flex items-center gap-4">
                            <label className="cursor-pointer group relative">
                                <input type="file" hidden onChange={(e) => {
                                    if(e.target.files[0]) {
                                        const r = new FileReader();
                                        r.onload = () => setLogo(r.result);
                                        r.readAsDataURL(e.target.files[0]);
                                    }
                                }} />
                                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-600 to-indigo-600 flex items-center justify-center overflow-hidden border border-white/20 shadow-lg group-hover:scale-105 transition-transform">
                                    {logo ? <img src={logo} className="w-full h-full object-cover" /> : <i className="fas fa-solar-panel text-white text-xl"></i>}
                                </div>
                                <div className="absolute -bottom-5 left-0 w-full text-center text-[9px] text-violet-400 opacity-0 group-hover:opacity-100 transition-opacity">CHANGE</div>
                            </label>
                            <div>
                                <h1 className="text-2xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-cyan-400 text-glow">RADIANT ENERGIES</h1>
                                <p className="text-[10px] tracking-[0.3em] text-violet-300/50 font-bold">MADE BY RAM</p>
                            </div>
                        </div>
                        <div className="flex bg-black/40 rounded-full p-1 border border-white/10">
                            {['sim', 'report'].map(t => (
                                <button key={t} onClick={() => setActiveTab(t)} className={`px-6 py-1.5 rounded-full text-xs font-bold uppercase transition-all ${activeTab === t ? 'bg-violet-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}>{t === 'sim' ? 'SIMULATOR' : 'REPORT'}</button>
                            ))}
                        </div>
                    </nav>

                    <main className="flex-grow p-6 overflow-y-auto">
                        <div className="grid md:grid-cols-3 gap-4 mb-6">
                            {[
                                {id: 'On-Grid', icon: 'fa-plug', t: 'Grid-Tied', d: 'Max Savings'},
                                {id: 'Off-Grid', icon: 'fa-tree', t: 'Off-Grid', d: 'Independence'},
                                {id: 'Hybrid', icon: 'fa-random', t: 'Hybrid', d: 'Smart Mix'}
                            ].map(s => (
                                <div key={s.id} onClick={() => setSystemType(s.id)} 
                                    className={`p-4 rounded-2xl border cursor-pointer transition-all flex items-center gap-4 ${systemType === s.id ? 'bg-violet-600/20 border-violet-500 shadow-[0_0_20px_rgba(139,92,246,0.2)]' : 'bg-white/5 border-white/5 hover:bg-white/10'}`}>
                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center text-lg ${systemType === s.id ? 'bg-violet-500 text-white' : 'bg-black/30 text-slate-400'}`}><i className={`fas ${s.icon}`}></i></div>
                                    <div><div className="font-display font-bold">{s.t}</div><div className="text-xs text-slate-400">{s.d}</div></div>
                                </div>
                            ))}
                        </div>

                        {activeTab === 'sim' ? (
                            <div className="grid lg:grid-cols-12 gap-6 h-full">
                                {/* LEFT CONTROLS */}
                                <div className="lg:col-span-4 space-y-4">
                                    {/* PANEL 1: SOLAR GENERATION */}
                                    <div className="glass-panel p-5 rounded-3xl space-y-4">
                                        <div className="flex justify-between items-center"><span className="text-xs font-bold text-violet-300 tracking-widest">SOLAR OUTPUT</span><span className="text-xs text-slate-500 font-mono">{systemSizeKW.toFixed(2)} kW</span></div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className={`bg-black/40 p-3 rounded-xl border ${loss > 0 ? 'border-red-500/30' : 'border-white/5'}`}>
                                                <div className="text-[10px] text-slate-400">DAILY YIELD</div>
                                                <div className={`text-xl font-display font-bold ${loss > 0 ? 'text-red-400' : 'text-white'}`}>{netDailyGen.toFixed(1)} <span className="text-xs">kWh</span></div>
                                                {loss > 0 && <div className="text-[9px] text-red-500 mt-1">-{loss.toFixed(1)} Loss</div>}
                                            </div>
                                            <div className="bg-black/40 p-3 rounded-xl border border-white/5">
                                                <div className="text-[10px] text-slate-400">MONTHLY</div>
                                                <div className="text-xl font-display font-bold text-white">{(netDailyGen*30).toFixed(0)} <span className="text-xs">kWh</span></div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* PANEL 2: TIME & GRID */}
                                    <div className="glass-panel p-5 rounded-3xl space-y-4">
                                        <div>
                                            <div className="flex justify-between mb-2"><span className="text-xs font-bold text-slate-400">TIME OF DAY</span><span className="text-xl font-display text-violet-300">{hour}:00</span></div>
                                            <input type="range" min="0" max="23" value={hour} onChange={(e) => setHour(Number(e.target.value))} />
                                        </div>
                                        <div className="pt-4 border-t border-white/10">
                                            <div className="flex justify-between items-center mb-3"><span className="text-xs font-bold text-slate-400">GRID CONTROL</span><button onClick={() => setGridOn(!gridOn)} className={`text-[9px] font-bold px-3 py-1 rounded ${gridOn ? 'bg-emerald-500 text-black' : 'bg-red-500 text-white'}`}>{gridOn ? 'ON' : 'OFF'}</button></div>
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-xs text-slate-500"><span>Cut Start</span><span>{cutStartTime}:00</span></div>
                                                <input type="range" min="6" max="18" value={cutStartTime} onChange={(e) => setCutStartTime(Number(e.target.value))} className="accent-red-500" />
                                                <div className="flex justify-between text-xs text-slate-500"><span>Duration</span><span className="text-red-400">{cutDuration} hrs</span></div>
                                                <input type="range" min="0" max="12" value={cutDuration} onChange={(e) => setCutDuration(Number(e.target.value))} className="accent-red-500" />
                                            </div>
                                        </div>
                                    </div>

                                    {/* PANEL 3: TOPCON ARRAY CONFIG (UPDATED UI) */}
                                    <div className="glass-panel p-5 rounded-3xl space-y-4">
                                        <div className="flex justify-between items-center border-b border-white/10 pb-2">
                                            <span className="text-xs font-bold text-slate-300">TOPCON ARRAY</span>
                                            <span className="text-[9px] text-violet-400 border border-violet-500/30 px-2 py-0.5 rounded">Bifacial</span>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <div className="flex justify-between text-[10px] text-slate-500 mb-1"><span>STRINGS</span><span className="text-white">{numStrings}</span></div>
                                                <input type="range" min="1" max="5" value={numStrings} onChange={(e) => setNumStrings(Number(e.target.value))} className="accent-violet-500"/>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-[10px] text-slate-500 mb-1"><span>PNL/STR</span><span className="text-white">{panelsPerString}</span></div>
                                                <input type="range" min="1" max="20" value={panelsPerString} onChange={(e) => setPanelsPerString(Number(e.target.value))} className="accent-violet-500"/>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between text-[10px] text-slate-500 mb-1"><span>PANEL WATTAGE</span><span className="text-white">{panelWatts}W</span></div>
                                            <input type="range" min="400" max="700" step="10" value={panelWatts} onChange={(e) => setPanelWatts(Number(e.target.value))} className="accent-violet-500"/>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2 pt-2 border-t border-white/10">
                                            <div className="bg-black/30 p-2 rounded text-center">
                                                <div className="text-[9px] text-slate-500">TOTAL PANELS</div>
                                                <div className="text-sm font-bold text-white">{totalPanels}</div>
                                            </div>
                                            <div className="bg-black/30 p-2 rounded text-center">
                                                <div className="text-[9px] text-slate-500">STRING VOC</div>
                                                <div className="text-sm font-bold text-yellow-400">{systemPVVolts}V</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* PANEL 4: BATTERY ANALYTICS */}
                                    {systemType !== 'On-Grid' && (
                                        <div className="glass-panel p-5 rounded-3xl space-y-4 border-l-4 border-l-emerald-500">
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs font-bold text-emerald-400 tracking-widest">BATTERY ANALYTICS</span>
                                                <div className="flex gap-1"><span className="text-[9px] bg-blue-500/20 text-blue-400 px-1 rounded">Li-Ion</span><span className="text-[9px] bg-purple-500/20 text-purple-400 px-1 rounded">3500 Cycles</span></div>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><div className="text-[10px] text-slate-500 mb-1">VOLTAGE</div><input type="number" className="w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-sm text-white" value={batteryVolt} onChange={(e) => setBatteryVolt(Number(e.target.value))} /></div>
                                                <div><div className="text-[10px] text-slate-500 mb-1">AMPS (Ah)</div><input type="number" className="w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-sm text-white" value={batteryAh} onChange={(e) => setBatteryAh(Number(e.target.value))} /></div>
                                            </div>

                                            {/* ANALYTICS DASHBOARD */}
                                            <div className="bg-black/40 p-3 rounded-xl border border-white/10 space-y-2">
                                                <div className="grid grid-cols-2 gap-2 text-[10px]">
                                                    <div><span className="text-slate-500 block">TOTAL CAP</span><span className="text-white font-mono">{batteryStats.totalCapacity} kWh</span></div>
                                                    <div><span className="text-slate-500 block">UNITS TO FULL</span><span className="text-yellow-400 font-mono">{batteryStats.unitsToFull} kWh</span></div>
                                                </div>
                                                <div className="border-t border-white/5 pt-2 flex justify-between items-center text-[10px]">
                                                    <span className="text-slate-500">EST. BACKUP</span>
                                                    <span className="text-emerald-400 font-bold font-mono text-sm">{batteryStats.estDischargeTime} Hours</span>
                                                </div>
                                                <div className="flex justify-between items-center text-[10px]">
                                                    <span className="text-slate-500">CHARGE TIME</span>
                                                    <span className={`${simState.batteryStatus==='Charging'?'text-blue-400':'text-slate-600'} font-mono`}>{simState.batteryStatus==='Charging'?simState.timeToFull:'--'}</span>
                                                </div>
                                            </div>

                                            {/* CONTROLS */}
                                            <div className="flex gap-2">
                                                <button onClick={()=>setBatteryLevel(0)} className="flex-1 text-[9px] border border-red-500/30 text-red-400 rounded hover:bg-red-900/20 py-1">DRAIN</button>
                                                <button onClick={()=>setBatteryLevel(50)} className="flex-1 text-[9px] border border-yellow-500/30 text-yellow-400 rounded hover:bg-yellow-900/20 py-1">50%</button>
                                                <button onClick={()=>setBatteryLevel(100)} className="flex-1 text-[9px] border border-emerald-500/30 text-emerald-400 rounded hover:bg-emerald-900/20 py-1">FULL</button>
                                            </div>
                                            <div><div className="flex justify-between text-xs text-slate-500 mb-1"><span>Home Load</span><span className="text-white">{loadWatts}W</span></div><input type="range" min="100" max="5000" step="100" value={loadWatts} onChange={(e) => setLoadWatts(Number(e.target.value))} /></div>
                                        </div>
                                    )}
                                </div>

                                {/* RIGHT VISUALIZER */}
                                <div className="lg:col-span-8 h-full min-h-[600px] relative glass-panel rounded-3xl overflow-hidden border-violet-500/20">
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                                    
                                    {/* STATUS */}
                                    <div className="absolute top-4 left-6 z-10">
                                        <div className="text-[10px] text-slate-500 tracking-widest uppercase">System Status</div>
                                        <div className="text-xl font-bold text-white text-glow">{simState.status}</div>
                                        <div className="text-xs text-violet-400 mt-1">{simState.houseSource} Powered</div>
                                    </div>

                                    {/* SVG */}
                                    <svg className="absolute inset-0 w-full h-full z-0 pointer-events-none" viewBox="0 0 100 100" preserveAspectRatio="none">
                                        {simState.flows.map((f, i) => <Connection key={i} from={f.from} to={f.to} active={true} />)}
                                        <Connection from="sun" to="inv" active={false} /><Connection from="inv" to="home" active={false} /><Connection from="inv" to="grid" active={false} /><Connection from="grid" to="home" active={false} />{systemType!=='On-Grid' && <Connection from="inv" to="bat" active={false} />}
                                    </svg>

                                    {/* NODES */}
                                    <div className={`absolute top-12 left-1/2 transform -translate-x-1/2 transition-opacity duration-1000 ${isDaytime ? 'opacity-100' : 'opacity-20'}`}>
                                        <div className="w-20 h-20 bg-amber-500 rounded-full blur-[50px] absolute"></div>
                                        <div className="relative text-amber-300 drop-shadow-[0_0_15px_rgba(251,191,36,0.8)]"><SunIcon /></div>
                                        <div className="text-center mt-3 bg-black/60 text-[10px] font-bold text-yellow-400 border border-yellow-500/30 rounded px-2 py-0.5 backdrop-blur-md">GEN: {simState.effectiveSolar}W</div>
                                    </div>

                                    {/* INVERTER SCREEN */}
                                    <InverterScreen 
                                        solarWatts={simState.effectiveSolar} loadWatts={loadWatts} 
                                        gridStatus={simState.effectiveGrid} batteryStatus={simState.batteryStatus} 
                                        batteryLevel={batteryLevel} systemType={systemType} 
                                        systemVolts={batteryVolt} pvVolts={systemPVVolts} chargingWatts={simState.chargingWatts} 
                                    />

                                    <div className={`absolute left-10 top-1/2 transform -translate-y-1/2 transition-opacity ${simState.effectiveGrid ? 'opacity-100' : 'opacity-40'}`}>
                                        <GridIcon />
                                        <div className={`text-[9px] text-center mt-2 font-bold px-2 py-0.5 rounded border backdrop-blur-md ${simState.gridFlowStatus === 'EXPORT' ? 'text-green-400 bg-green-900/30 border-green-500/30' : simState.gridFlowStatus === 'IMPORT' ? 'text-red-400 bg-red-900/30 border-red-500/30' : 'text-slate-400 bg-black/50 border-white/10'}`}>
                                            {simState.gridFlowLabel}
                                        </div>
                                    </div>
                                    <div className="absolute right-10 top-1/2 transform -translate-y-1/2">
                                        <div className={`${simState.houseSource === 'Blackout' ? 'text-red-500' : 'text-violet-400'}`}><HomeIcon /></div>
                                        <div className="text-[9px] text-center mt-2 font-bold text-violet-300 bg-violet-900/30 border border-violet-500/30 px-2 py-0.5 rounded backdrop-blur-md">LOAD: {loadWatts}W</div>
                                    </div>
                                    {systemType !== 'On-Grid' && (
                                        <div className="absolute bottom-10 left-1/2 transform -translate-x-1/2">
                                            <BatteryIcon level={batteryLevel} />
                                            <div className={`text-[9px] text-center mt-2 font-bold px-2 py-0.5 rounded border backdrop-blur-md ${simState.batteryStatus === 'Charging' ? 'text-green-400 bg-green-900/30 border-green-500/30' : simState.batteryStatus === 'Discharging' ? 'text-yellow-400 bg-yellow-900/30 border-yellow-500/30' : 'text-slate-400 bg-black/50 border-white/10'}`}>
                                                {batteryLevel.toFixed(0)}% {simState.batteryStatus !== 'Idle' ? `(${simState.batteryStatus.substring(0,3).toUpperCase()})` : ''}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div className="glass-panel p-8 rounded-3xl border-t border-violet-500/20">
                                <h2 className="text-2xl font-bold text-white mb-6">Yearly Yield Report</h2>
                                <div className="p-4 bg-red-500/10 border border-red-500/20 rounded-xl mb-6">
                                    <div className="text-sm text-red-400 font-bold mb-1">Loss Analysis</div>
                                    <div className="text-xs text-slate-300">
                                        System: <b>{systemType}</b> | Size: <b>{systemSizeKW.toFixed(2)} kW</b> | Daytime Cuts: <b>{cutDuration}h</b>
                                        <br/>{loss > 0 ? `Estimated Annual Loss: ${Math.round(loss*365)} kWh due to grid downtime.` : 'Optimal Generation.'}
                                    </div>
                                </div>
                                <div className="grid md:grid-cols-3 gap-4">
                                    <div className="bg-black/40 p-4 rounded-xl border border-white/5"><div className="text-xs text-slate-400 mb-1">SUMMER</div><div className="text-xl font-bold text-white">{Math.round(netDailyGen * 120)} kWh</div></div>
                                    <div className="bg-black/40 p-4 rounded-xl border border-white/5"><div className="text-xs text-slate-400 mb-1">MONSOON</div><div className="text-xl font-bold text-white">{Math.round(netDailyGen * 0.6 * 90)} kWh</div></div>
                                    <div className="bg-black/40 p-4 rounded-xl border border-white/5"><div className="text-xs text-slate-400 mb-1">WINTER</div><div className="text-xl font-bold text-white">{Math.round(netDailyGen * 0.9 * 155)} kWh</div></div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* FOOTER */}
                    <footer className="glass-panel border-t-white/5 mt-auto">
                        <div className="max-w-7xl mx-auto px-6 py-8 flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-500 border border-violet-500/20">
                                    <i className="fas fa-bolt"></i>
                                </div>
                                <span className="font-display font-bold text-sm tracking-widest text-slate-400">RADIANT ENERGIES</span>
                            </div>
                            <div className="text-xs text-slate-500 text-center md:text-right">
                                <p>&copy; 2026 Radiant Energies. All rights reserved.</p>
                                <p className="mt-1 font-medium text-slate-400">Made by Ram</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>